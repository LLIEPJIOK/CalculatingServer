## CalculationServer

Читайте это на других языках: [English](https://github.com/LLIEPJIOK/CalculatingServer/blob/master/README.md).

CalculationServer - это сервер, который вычисляет выражения в течение заданного времени операции.

В проекте также используется база данных PostgresSQL, [Bootstrap](https://getbootstrap.com) и [HTMX](https://htmx.org). Bootstrap используется для создания быстрого и визуально привлекательного интерфейса, в то время как HTMX используется для отправки запросов и их удобной обработки.

## Начало работы
Для запуска сервера вам понадобятся:
- [Go](https://golang.org/dl) версии 1.22 или новее.
- [PostgreSQL](https://postgresql.org/download). Вам может понадобиться VPN для установки.

Чтобы начать работу с сервером, выполните следующие шаги:
1. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/LLIEPJIOK/CalculatingServer.git
   ```
2. Откройте файл `expressions/database.go` и измените `port` и `password`, чтобы они соответствовали вашему порту и паролю PostgreSQL.
3. Откройте консоль в папке проекта:
   - Загрузите необходимые пакеты
      ```bash
      go mod download
      ```
   - Запустите программу
      ```bash
      go run main.go
      ```
4. Откройте [`localhost:8080`](http://localhost:8080) в вашем браузере.

## Структура кода
1. `main.go` - файл для сервера, где обрабатываются запросы.
2. `expressions/expressions.go` - файл для обработки выражений.
3. `expressions/database.go` - файл для взаимодействия с базой данных PostgreSQL.
4. `static/` - папка для визуального интерфейса. Она содержит стили CSS, JS-скрипт для очистки поля ввода после отправки выражения, и HTML-шаблоны с Bootstrap и HTMX.

## Принцип работы
Программа состоит из сервера, обрабатывающего все запросы, и агентов, которые являются горутинами, ответственными за асинхронное вычисление выражений. Горутины также обновляют свой статус (например, ожидание, вычисление и т. д.) каждые 5 секунд, если они ждут выражение, а также перед и после выполнения вычислений.

Когда пользователь отправляет запрос (например, открывает страницу, отправляет выражение и т. д.), сервер обрабатывает его, и существует несколько возможных сценариев:

1. **Запрос на вычисление выражения:**
   
   Сервер добавляет выражение в базу данных, затем анализирует его, чтобы убедиться в его правильности.
   - Если выражение допустимо, сервер передает его агентам через канал. В какой-то момент один из агентов забирает его, вычисляет выражение, а затем обновляет результат.
   - Если выражение недопустимо, сервер устанавливает ошибку разбора в статус выражения.
   Затем сервер обновляет последние выражения.

2. **Запрос на обновление времени операции:**

   Сервер обновляет эту информацию в базе данных.

3. **Другие запросы:**

   Сервер извлекает информацию из базы данных и отображает ее.

![Схема работы](https://github.com/LLIEPJIOK/CalculatingServer/blob/master/images/WorkingScheme.png)

*Примечание: В настоящее время нет автоматического обновления данных на странице. Чтобы увидеть изменения, вы должны перезагрузить страницу.*

## Пример использования
![Пример использования](https://github.com/LLIEPJIOK/CalculatingServer/blob/master/images/ServerUsage.gif)